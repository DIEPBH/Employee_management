{% extends 'base.html' %}
{% block content %}
    <div class="container-fluid page-header">
        <i class="fa-solid fa-users me-2"></i>
        <h1>TRA CỨU THÔNG TIN CÁN BỘ</h1>
    </div>
    <!-- Khu vực tìm kiếm -->
        <div class="container-fluid mt-3 px-0" id="search-panel-wrapper">
            <div class="search-panel" id="search-panel">
                <button type="button"
                    id="toggle-search"
                    class="search-toggle"
                    aria-label="Ẩn/Hiện điều kiện">
                    ^
                </button>
                <form method="get" class="search-form">
                    <div class="search-grid">
                        <div class="search-item">
                            <label class="search-label">Số hiệu</label>
                            <input type="text" name="emp_num" class="search-control"
                                value="{{ request.GET.emp_num|default:'' }}" placeholder="Nhập số hiệu">
                        </div>

                        <div class="search-item">
                            <label class="search-label">Họ và tên</label>
                            <input type="text" name="full_name" class="search-control"
                                value="{{ request.GET.full_name|default:'' }}" placeholder="Nhập họ và tên">
                        </div>

                        <div class="search-item">
                            <label class="search-label">Ngày sinh</label>
                            <input type="date" name="dob" class="search-control"
                                value="{{ request.GET.dob|default:'' }}">
                        </div>

                        <div class="search-item">
                            <label class="search-label">Giới tính</label>
                            <select name="gender" class="search-control">
                            <option value="">-- Tất cả --</option>
                            <option value="M" {% if request.GET.gender == "M" %}selected{% endif %}>Nam</option>
                            <option value="F" {% if request.GET.gender == "F" %}selected{% endif %}>Nữ</option>
                            </select>
                        </div>

                        <div class="search-item">
                            <label class="search-label">Quê quán</label>
                            <input type="text" name="hometown" class="search-control"
                                value="{{ request.GET.hometown|default:'' }}" placeholder="Nhập quê quán">
                        </div>
                    </div>

                    <div class="search-actions">
                    <button type="submit" class="btn btn-primary">Tìm kiếm</button>

                    <!-- Nút reset: quay về trang index không có query -->
                    <a href="{% url 'employee:index' %}" class="btn btn-outline-secondary">Xóa lọc</a>
                    </div>
                </form>
            </div>
        </div>

    <!-- Nút thêm mới -->
    <div class="d-flex justify-content-end align-items-center mt-3">
        <button
            class="btn btn-success js-open-modal"
            data-modal-url="{% url 'employee:add_employee_modal' %}"
            data-modal-title="Thêm mới cán bộ"
            data-modal-type="employee">
            <i class="fa-solid fa-plus me-2"></i> Thêm mới
        </button>
    </div>



    <!-- Khu vực bảng dữ liệu -->
    
    <div class="container-fluid table-area">
            <div class = "table-wrap">
            <!-- Bảng dữ liệu: cuộn ngang -->
            <div class="table-scroll">
                <table class="table table-data table-hover table-master table-bordered mt-3 text-center resizable-table">
                    <thead class="head-blue">
                        <tr>
                            <th>
                                <span class="th-ellipsis">Số hiệu</span>
                                <div class="col-resizer"></div>
                            </th>
                            <th class="col-fullname">
                                <span class="th-ellipsis">Họ và tên</span>
                                <div class="col-resizer"></div>
                            </th>
                            <th>
                                <span class="th-ellipsis">Ngày sinh</span>
                                <div class="col-resizer"></div>
                            </th>
                            <th>
                                <span class="th-ellipsis">Giới tính</span>
                                <div class="col-resizer"></div>
                            </th>
                            <th>
                                <span class="th-ellipsis">Quê quán</span>
                                <div class="col-resizer"></div>
                            </th>
                            <th>
                                <span class="th-ellipsis">Nơi cư trú hiện tại</span>
                                <div class="col-resizer"></div>
                            </th>
                            <th>
                                <span class="th-ellipsis">Dân tộc</span>
                                <div class="col-resizer"></div>
                            </th>
                            <th>
                                <span class="th-ellipsis">Tôn giáo</span>
                                <div class="col-resizer"></div>
                            </th>
                            <th>
                                <span class="th-ellipsis">Nghề nghiệp của gia đình</span>
                                <div class="col-resizer"></div>
                            </th>
                            <th>
                                <span class="th-ellipsis">Công việc trước đây</span>
                                <div class="col-resizer"></div>
                            </th>
                            <th>
                                <span class="th-ellipsis">Ngày vào đoàn</span>
                                <div class="col-resizer"></div>
                            </th>
                            <th>
                                <span class="th-ellipsis">Đoàn viên</span>
                                <div class="col-resizer"></div>
                            </th>
                            <th>
                                <span class="th-ellipsis">Ngày vào Đảng</span>
                                <div class="col-resizer"></div>
                            </th>
                            <th>
                                <span class="th-ellipsis">Ngày chính thức</span>
                                <div class="col-resizer"></div>
                            </th>
                            <th>
                                <span class="th-ellipsis">Ngày tuyển dụng</span>
                                <div class="col-resizer"></div>
                            </th>
                            <th>
                                <span class="th-ellipsis">Ngày vào công an</span>
                                <div class="col-resizer"></div>
                            </th>
                            <th>
                                <span class="th-ellipsis">Nơi tuyển dụng</span>
                                <div class="col-resizer"></div>
                            </th>
                            <th>
                                <span class="th-ellipsis">Nguồn tuyển dụng</span>
                                <div class="col-resizer"></div>
                            </th>
                            <th>
                                <span class="th-ellipsis">Nhóm máu</span>
                                <div class="col-resizer"></div>
                            </th>
                            <th>
                                <span class="th-ellipsis">Danh hiệu được phong</span>
                                <div class="col-resizer"></div>
                            </th>
                            <th>
                                <span class="th-ellipsis">Địa chỉ hồ sơ</span>
                                <div class="col-resizer"></div>
                            </th>
                            <th>
                                <span class="th-ellipsis">Năng lực nổi bật</span>
                                <div class="col-resizer"></div>
                            </th>
                            <th>
                                <span class="th-ellipsis">Mô tả</span>
                                <div class="col-resizer"></div>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for employee in employees %}
                        <tr>
                            <td data-bs-toggle="tooltip" title="{{ employee.emp_num }}">{{ employee.emp_num }}</td>
                            <td class = "col-fullname">{{ employee.full_name }}</td>
                            <td data-bs-toggle="tooltip" title="{{ employee.day_of_birth }}">{{ employee.day_of_birth|date:"d/m/Y"|default_if_none:"" }}</td>
                            <td data-bs-toggle="tooltip" title="{{ employee.get_gender_display }}">{{ employee.get_gender_display }}</td>
                            <td data-bs-toggle="tooltip" title="{{ employee.place_of_hometown }}">{{ employee.place_of_hometown }}</td>
                            <td data-bs-toggle="tooltip" title="{{ employee.current_residence }}">{{ employee.current_residence }}</td>
                            <td data-bs-toggle="tooltip" title="{{ employee.nation }}">{{ employee.nation }}</td>
                            <td data-bs-toggle="tooltip" title="{{ employee.religion }}">{{ employee.religion }}</td>
                            <td data-bs-toggle="tooltip" title="{{ employee.family_job }}">{{ employee.family_job }}</td>
                            <td data-bs-toggle="tooltip" title="{{ employee.before_job }}">{{ employee.before_job }}</td>
                            <td data-bs-toggle="tooltip" title="{{ employee.date_in_group }}">{{ employee.date_in_group|date:"d/m/Y"|default_if_none:"" }}</td>
                            <td data-bs-toggle="tooltip" title="{{ employee.get_union_display }}">{{ employee.get_union_display }}</td>
                            <td data-bs-toggle="tooltip" title="{{ employee.day_of_joining_the_party }}">{{ employee.day_of_joining_the_party|date:"d/m/Y"|default_if_none:"" }}</td>
                            <td data-bs-toggle="tooltip" title="{{ employee.day_offical }}">{{ employee.day_offical|date:"d/m/Y"|default_if_none:"" }}</td>
                            <td data-bs-toggle="tooltip" title="{{ employee.recruitment_day }}">{{ employee.recruitment_day|date:"d/m/Y"|default_if_none:"" }}</td>
                            <td data-bs-toggle="tooltip" title="{{ employee.date_of_joining_the_police }}">{{ employee.date_of_joining_the_police|date:"d/m/Y"|default_if_none:"" }}</td>
                            <td data-bs-toggle="tooltip" title="{{ employee.recruitment_place }}">{{ employee.recruitment_place }}</td>
                            <td data-bs-toggle="tooltip" title="{{ employee.recruitment_source }}">{{ employee.recruitment_source }}</td>
                            <td data-bs-toggle="tooltip" title="{{ employee.blood_type }}">{{ employee.blood_type }}</td>
                            <td data-bs-toggle="tooltip" title="{{ employee.appellation }}">{{ employee.appellation }}</td>
                            <td data-bs-toggle="tooltip" title="{{ employee.keep_records }}">{{ employee.keep_records }}</td>
                            <td data-bs-toggle="tooltip" title="{{ employee.forte_ability }}">{{ employee.forte_ability }}</td>
                            <td data-bs-toggle="tooltip" title="{{ employee.Descriptions }}">{{ employee.Descriptions }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <!-- Bảng action: đứng riêng, không cuộn ngang -->
            <div class="table-actions table-action">
                    <table class="table table-hover table-bordered mt-3 text-center table-action">
                        <thead class="head-blue">
                            <tr>
                            <th></th>
                            <th></th>
                            </tr>
                        </thead>

                        <tbody>
                            {% for employee in employees %}
                            <tr>
                            <td>
                                <button
                                    class="btn btn-sm btn-warning js-open-modal"
                                    data-modal-url="{% url 'employee:edit_employee_modal' employee.id %}"
                                    data-modal-title="Sửa thông tin cán bộ"
                                    data-modal-type="employee">
                                    <i class="fa-solid fa-pen-to-square"></i>
                            </button>

                            </td>
                            <td>
                                <form action="{% url 'employee:delete_employee' employee.id %}" method="post">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-sm btn-danger"
                                        onclick="return confirm('Bạn có chắc chắn muốn xóa')" title="Xóa">
                                    <i class="fa-solid fa-trash"></i>
                                </button>
                                </form>
                            </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="table-pagination">
                {% if page_obj.has_previous %}
                    <a class="pg" href="?page=1{% if querystring %}&{{ querystring }}{% endif %}">&laquo;</a>
                    <a class="pg" href="?page={{ page_obj.previous_page_number }}{% if querystring %}&{{ querystring }}{% endif %}">&lsaquo;</a>
                {% endif %}

                {% for num in page_obj.paginator.page_range %}
                    {% if page_obj.number == num %}
                    <span class="pg active">{{ num }}</span>
                    {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                    <a class="pg" href="?page={{ num }}{% if querystring %}&{{ querystring }}{% endif %}">{{ num }}</a>
                    {% endif %}
                {% endfor %}

                {% if page_obj.has_next %}
                    <a class="pg" href="?page={{ page_obj.next_page_number }}{% if querystring %}&{{ querystring }}{% endif %}">&rsaquo;</a>
                    <a class="pg" href="?page={{ page_obj.paginator.num_pages }}{% if querystring %}&{{ querystring }}{% endif %}">&raquo;</a>
                {% endif %}
            </div>
    </div>

{% endblock %}
